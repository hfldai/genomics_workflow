1. Input files: fastq/ bam fragments
- name conventions:
    - FASTQ include replicates: xxx_RepX_1.fastq.gz, xxx_RepX_2.fastq.gz
    - FASTQ not include replicates: xxx_1.fastq.gz, xxx_2.fastq.gz
    - bam include replicates: xxx_RepX.bam ...
    - bam not include replicates: xxx.bam
2. Bulk & single-cell
3. peak calling: 
 - how to consider replicates.
4. add whether need some intermediate files & downstream
5. ENCODE standard


2. fastqc
3. adapter trimming:
    -a. not know adapter seq: trim galore!
    -b. know adapter seq: cutadapt [40], AdapterRemoval v2 [41], Skewer [42], and trimmomatic [43] all requiring input of known adapter sequences
-[x] 4. alignment: bwamem2 OR bowtie2
-[x] 5. mark duplicates
5. peak calling
-[x] macs2
-[x] lanceotron
-[ ] HMMRATAC
-[ ] RCL
6. downstream: peak annotation; GWAS prioritisation (& imputation?)

<!-- 
scRNA-seq
GWAS
pheWAS
variant call
eQTL
TCGA
1000 Genome project
NCBI
Cosmic
ClinVar
UK Biobank
TCGA
dbSNP
OMIM
GTEx -->


# Chromatin accessibility data, processing
DNase-seq datasets profiling genome-wide chromatin accessibility were downloaded from the Roadmap Epigenomics Project (http://www.ncbi.nlm.nih.gov/geo/roadmap/epigenomics/) and ENCODE (https://www.encodeproject.org/). The fastq files were aligned with BWA aln (v0.7.10), where all datasets were treated as single-end, with ENCODE default alignment parameters. 
After mapping, reads were filtered to remove unmapped reads and mates, non-primary alignments, reads failing platform/vendor quality checks and PCR/optical duplicates (-F 1804). Low quality reads (MAPQ < 30) were also removed. 
Duplicates were then marked with Picard MarkDuplicates and removed. 
The final filtered file was then converted to tagAlign format (BED 3 + 3) using bedtools bamtobed. 
Cross-correlation scores were then obtained for each file using phantompeakqualtools (v1.1).

All files were checked to have cross-correlation with a quality tag above 0 and discarded if not. 
For the ENCODE data generated from the Stam Lab protocol, all datasets were trimmed to 36 bp and then technical replicates were combined. 
Read depths were considered, and a standardized depth of 50 million reads was set for the final datasets. 
As such, the files were filtered to remove mitochondrial reads, filtered for mappability (MAPQ > 30) and then subsampled to 50 million reads. 
For the ENCODE data generated from the Crawford Lab protocol, the same procedure as above was performed, except reads were trimmed to 20 bp due to the different library generation protocol. 
For the Roadmap data, which was all generated by the Stam Lab protocol, the same procedure as above was performed with trimming to 36 bp, and files were only combined to give a minimum read depth of 50 million reads, since each file came from a different developmental time point. 

These trimmed, filtered, subsampled tagAlign files were then used to generate signal tracks and call peaks. Signal tracks and peaks were called with a loose threshold (P < 0.01) with MACS2 to generate bigwig files (fold enrichment and P-value) and narrowPeak files, respectively.

To identify reproducible peaks, we performed pseudoreplicate subsampling on the pooled reads across all replicates (taking all reads from the final tagAligns and splitting in half by random assignment to two replicates) and retaining reproducible peaks passing an Irreproducible Discovery Rate (v2.0.3) (Li et al., 2011) (https://github.com/kundajelab/idr) threshold of 0.1 to get a reproducible peaks for each DNase experiment. 
The pipeline is available in a Zenodo record https://doi.org/10.5281/zenodo.156534.

We bin the human genome (GRCh37 assembly) into 200 bp bins (⁠
⁠) every 50 bp. For each of the 123 cellular contexts (⁠
⁠), all bins are assigned binary labels (⁠
⁠) corresponding to accessible (+1) or inaccessible (0) state based on whether they overlap (>50% overlap) context-specific reproducible DNase-seq peaks or not. 

The genome-wide binary labels for each task j (cellular context) are highly imbalanced (Proportion of positive bins: min = 3%, median = 7%, max = 10% across cell types). 
The complete binary label matrix is available via a Zenodo archive https://doi.org/10.5281/zenodo.2603199. 
The cis-regulatory sequence context (Si) for each bin i is represented using 1000 bp of genomic DNA sequence centered at the bin. 
We use a 1000 bp sequence context since previous work showed performance gains using contexts up to 1000 bp (Avsec et al., 2018; Zhou and Troyanskaya, 2015).

# Gene expression data
RNA-seq fastq files (no subsampling, no filtering, no trimming) from Roadmap and ENCODE were mapped using the STAR aligner (version 2.4.1d), using ENCODE default parameters. 
GENCODE release 19 (GRCh37.p13) transcriptome annotations were used. 
To determine the strandedness of the file (which is needed for RSEM quantification), the infer_experiment.py script from RSeQC (version 2.6.4) was used in conjunction with the STAR output that was sorted by coordinate. The strandedness and the pairedness (paired-end or single-end) of the experiment were passed on to RSEM (version 1.2.21). 
For RSEM, we used ‘–estimate-rspd’ to estimate read start position distribution, and we did not calculate confidence bounds. 
If the experiment was stranded, we set ‘–forward-prob’ to be 0, and unstranded experiments were left at default. The transcriptome aligned file from STAR was used in the RSEM run.
The complete list of RNA-seq datasets and their identifiers is provided in Supplementary Table S3. The pipeline is available at https://github.com/ENCODE-DCC/rna-seq-pipeline (v1.0).

The final dataset includes RNA-seq data associated with each of the 123 cell types. We extract the transcripts per million (TPM) values and use the log transformed TPM values.

The trans-regulatory feature space Rj for each cellular context is represented by the log(TPM) expression levels 
of a list of 1630 putative TFs as curated by the FANTOM5 consortium (http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19) of human TFs. 
The TF gene expression feature matrix is available via a Zenodo archive https://doi.org/10.5281/zenodo.2603199.